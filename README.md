# Cloud Bot - Bilibili 云朵分析评论机器人

一个智能的Bilibili评论机器人，能够分析动态中的云朵图片并生成相关的评论内容。

## 功能特性

- 🔍 **@消息监控**: 自动监控收到的@消息，检测包含图片的动态
- ☁️ **云朵分析**: 使用AI分析图片中的云朵类型和天气条件
- 💬 **智能评论**: 根据云朵分析结果生成萌妹风格的评论内容
- 🤖 **自动化**: 自动检测是否已评论，避免重复评论
- 🧪 **测试模式**: 提供测试模式来验证comment生成效果
- 📸 **打卡纪念图**: 自动生成个性化打卡纪念图片并上传到评论中
- 🗄️ **数据统计**: 记录用户打卡数据，支持统计查询
- 🛠️ **调试工具**: 提供CLI命令管理已处理消息

## 云朵分析功能

### 分析内容
- **云朵类型识别**: 识别积云、层积云、卷云、雨层云等
- **天气预测**: 基于云朵类型预测可能的天气条件
- **萌妹风格**: 使用可爱的二次元萌妹语气润色分析结果
- **详细描述**: 提供专业的云朵形态和天气分析

### 生成的Comment内容
生成的comment特点：
- ☁️ 云朵类型识别和天气分析
- 💕 可爱的二次元萌妹语气
- 🌸 日语词汇点缀（だよ、ですね、すごい等）
- (｡･ω･｡) 萌萌的表情符号
- 简洁可爱，控制在100字以内

## 打卡纪念图功能 ✨

### 功能介绍
- **自动生成**: 每次成功评论后，自动为用户生成个性化的打卡纪念图
- **用户统计**: 基于用户的历史打卡数据，显示打卡次数、云朵类型统计等
- **集章册样式**: 美观的集章册设计，包含10种标准云朵类型
- **自动上传**: 生成的图片自动上传到B站图床，并添加到评论中

### 集章册内容
- 📊 个人打卡统计（总次数、图片数、发现的云彩种类）
- ☁️ 10种标准云朵类型的收集进度
- 🏆 成就展示和完成度
- 🎨 精美的视觉设计

### 启用方式
在 `src/config.ts` 中设置：
```typescript
enableCheckInImage: true  // 启用打卡纪念图功能
```

## 配置说明

在 `src/config.ts` 中配置以下参数：

```typescript
export const config = {
  // Bilibili cookie (必需)
  cookie: "your_cookie_here",
  
  // 要检查的用户ID (你自己的UID)
  uidToMonitor: "your_user_id",
  
  // 默认评论内容（当云朵分析失败时使用）
  commentText: "好漂亮的☁️！",
  
  // 检查间隔（毫秒）
  checkInterval: 10000,
  
  // 云朵分析功能配置
  enableCloudAnalysis: true,
  
  // 是否启用打卡纪念图片生成和上传
  enableCheckInImage: true,

  // OpenAI API 配置
  openai: {
    apiKey: "your_api_key",
    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1",
    model: "qwen-vl-plus",
  },
};
```

## 安装和运行

1. 安装依赖：
```bash
npm install
```

2. 配置参数：
   - 在 `src/config.ts` 中填入你的Bilibili cookie
   - 配置OpenAI API密钥（如果使用云朵分析功能）
   - 设置你的用户ID

3. 运行机器人：
```bash
npm start
```

4. **测试模式**（新功能）：
```bash
npm start -- --test
```

## 测试模式

测试模式是一个新增的功能，用于测试comment生成效果：

### 使用方法
```bash
npm start -- --test
```

### 测试模式功能
- 🔍 获取最近的一个@消息
- 📷 分析消息中的图片内容
- ☁️ 生成云朵分析和萌妹风格comment
- 📝 打印生成的comment内容
- ❌ **不会实际发布评论**
- ✅ 程序执行完成后自动结束

### 测试输出示例
```
Starting Test Mode - 测试comment生成效果...
正在获取最近的@消息...
找到最新@消息! ID: 123456789, 来自: 用户名
消息标题: 今天的云朵好漂亮
URI: https://www.bilibili.com/opus/1093350140720185351
发现 2 张图片:
  1. 内容图片 1 (1920x1080): https://example.com/image1.jpg
  2. 内容图片 2 (1920x1080): https://example.com/image2.jpg

=== 开始云朵分析 ===
=== 生成的comment内容 ===
"哇～这些积云看起来すごい可爱呢！(｡･ω･｡) 天空中飘着蓬松的白云朵，给人一种很治愈的感觉だよ♡ 这样的天气最适合出门拍照啦～(*´ω｀*)"

=== 测试完成 ===
注意：在测试模式下，comment不会被实际发布
```

## 云朵分析示例

### 分析结果（萌妹风格）
```
"这是典型的积云だよ～(≧∀≦) 看起来像棉花糖一样ふわふわ呢！天气应该会很不错，适合お散歩♡ 拍得真きれい！(◕‿◕)"
```

## 注意事项

- 请确保你的Bilibili cookie是有效的
- 不要设置过短的检查间隔，避免被限流
- 云朵分析功能需要有效的OpenAI API密钥
- 建议先使用测试模式验证功能正常后再运行正式版本
- 机器人只会对包含图片的@消息进行分析和评论

## 工作流程

1. **监控@消息**: 定期检查收到的@消息
2. **筛选图片动态**: 只处理包含图片的动态
3. **检查重复评论**: 确保不会重复评论同一条动态
4. **云朵分析**: 对图片进行AI分析
5. **生成评论**: 将分析结果转换为萌妹风格的评论
6. **发布评论**: 自动发布生成的评论

## 技术栈

- TypeScript
- Axios (HTTP请求)
- OpenAI API (云朵分析)
- Node.js